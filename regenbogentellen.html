<!DOCTYPE html>
<html lang="nl">

<head>
  <meta charset="UTF-8">
  <title>Regenbogen Tellen Spel</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 30px;
    }

    .dobbelstenen {
      margin: 20px 0;
    }

    .dobbelsteen {
      width: 50px;
      height: 50px;
      display: inline-block;
      margin: 0 5px;
    }

    .rainbows {
      margin: 20px 0;
      min-height: 220px;
    }

    .rainbow {
      display: inline-block;
      margin: 10px;
      vertical-align: bottom;
    }

    .vraag {
      font-size: 1.2em;
      margin: 20px 0;
    }

    .feedback {
      font-weight: bold;
      margin: 10px 0;
    }

    button {
      font-size: 1em;
      padding: 8px 16px;
    }

    #fireworkCanvas {
      position: fixed;
      left: 0;
      top: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 1000;
      display: none;
    }
  </style>
</head>

<body>
  <h1>Regenbogen Tellen</h1>
  <button id="rollBtn">Gooi dobbelstenen</button>
  <div class="dobbelstenen" id="dobbelstenen"></div>
  <div class="rainbows" id="rainbows"></div>
  <div class="vraag" id="vraag"></div>
  <input type="number" id="antwoord" style="display:none;" min="0">
  <button id="checkBtn" style="display:none;">Controleer</button>
  <div class="feedback" id="feedback"></div>
  <canvas id="fireworkCanvas"></canvas>
  <audio id="diceSound" src="https://cdn.pixabay.com/audio/2022/07/26/audio_124bfae3b2.mp3"></audio>

  <script>
    // Alleen deze 8 kleuren
    const kleuren = [
      { naam: 'geel', kleur: '#ffe600' },
      { naam: 'oranje', kleur: '#ff9900' },
      { naam: 'rood', kleur: '#ff0000' },
      { naam: 'groen', kleur: '#00c800' },
      { naam: 'donker blauw', kleur: '#0033cc' },
      { naam: 'licht blauw', kleur: '#00cfff' },
      { naam: 'violet', kleur: '#8f00ff' },
      { naam: 'roze', kleur: '#ff66cc' }
    ];
    let regenbogen = [];
    let gevraagdeKleur = null;
    let juisteAantal = 0;
    let dobbel1 = 1, dobbel2 = 1;

    function randomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function randomKleur() {
      return kleuren[randomInt(0, kleuren.length - 1)];
    }

    function tekenDobbelsteen(num) {
      // SVG dobbelsteen met stippen
      const stip = (cx, cy) => `<circle cx="${cx}" cy="${cy}" r="5" fill="#222"/>`;
      let stippen = [];
      if ([1, 3, 5].includes(num)) stippen.push(stip(25, 25));
      if (num >= 2) { stippen.push(stip(12, 12), stip(38, 38)); }
      if (num >= 4) { stippen.push(stip(12, 38), stip(38, 12)); }
      if (num === 6) { stippen.push(stip(12, 25), stip(38, 25)); }
      return `<svg class="dobbelsteen" viewBox="0 0 50 50"><rect width="50" height="50" rx="10" fill="#fff" stroke="#aaa" stroke-width="2"/>${stippen.join('')}</svg>`;
    }

    function gooiDobbelstenen() {
      dobbel1 = randomInt(1, 6);
      dobbel2 = randomInt(1, 6);
      document.getElementById('dobbelstenen').innerHTML = tekenDobbelsteen(dobbel1) + tekenDobbelsteen(dobbel2);
      document.getElementById('diceSound').currentTime = 0;
      document.getElementById('diceSound').play();
      let aantal, kleurTelling, geschikteKleuren, gekozenKleur;
      // Herhaal tot we een kleur hebben die 10-20 keer voorkomt
      do {
        aantal = dobbel1 + dobbel2;
        regenbogen = [];
        for (let i = 0; i < aantal; i++) {
          let bogen = randomInt(3, 8);
          let rainbow = [];
          for (let j = 0; j < bogen; j++) {
            rainbow.push(randomKleur());
          }
          regenbogen.push(rainbow);
        }
        // Tellen
        kleurTelling = {};
        regenbogen.flat().forEach(k => {
          kleurTelling[k.naam] = (kleurTelling[k.naam] || 0) + 1;
        });
        geschikteKleuren = Object.entries(kleurTelling).filter(([_, v]) => v >= 10 && v <= 20);
      } while (geschikteKleuren.length === 0);
      // Kies een van de geschikte kleuren als gevraagde kleur
      gekozenKleur = geschikteKleuren[randomInt(0, geschikteKleuren.length - 1)][0];
      // Sla de naam op voor stelVraag
      window.geforceerdeVraagKleur = gekozenKleur;
      toonRegenbogen();
      stelVraag();
    }

    function toonRegenbogen() {
      const rainbowsDiv = document.getElementById('rainbows');
      rainbowsDiv.innerHTML = '';
      // Bepaal de grootste regenboog (meeste bogen)
      let maxBogen = 3;
      regenbogen.forEach(r => { if (r.length > maxBogen) maxBogen = r.length; });
      // SVG breedte/hoogte zodat alles past
      const baseHoogte = 40 + maxBogen * 20;
      const baseBreedte = 80 + maxBogen * 20;
      regenbogen.forEach(rainbow => {
        const bogen = rainbow.length;
        // Regenboog centreren in het grotere SVG-veld
        let svg = `<svg class="rainbow" width="${baseBreedte}" height="${baseHoogte}" viewBox="0 0 ${baseBreedte} ${baseHoogte}">`;
        for (let i = 0; i < bogen; i++) {
          const kleur = rainbow[i].kleur;
          const r = (bogen - i) * 20;
          const offset = (maxBogen - bogen) * 20;
          svg += `<path d="M${baseBreedte / 2 - r},${baseHoogte - 10 - offset} A${r},${r} 0 0 1 ${baseBreedte / 2 + r},${baseHoogte - 10 - offset}" stroke="${kleur}" stroke-width="15" fill="none"/>`;
        }
        svg += '</svg>';
        rainbowsDiv.innerHTML += svg;
      });
    }

    function stelVraag() {
      // Kies de geforceerde kleur als vraagkleur
      const gebruikteKleuren = regenbogen.flat();
      let kleurObj = kleuren.find(k => k.naam === window.geforceerdeVraagKleur);
      gevraagdeKleur = kleurObj;
      juisteAantal = gebruikteKleuren.filter(k => k.naam === gevraagdeKleur.naam).length;
      document.getElementById('vraag').innerHTML = `Hoe vaak komt deze kleur voor? <span style="display:inline-block;width:30px;height:30px;border-radius:50%;background:${gevraagdeKleur.kleur};vertical-align:middle;border:1px solid #aaa;"></span> <b>${gevraagdeKleur.naam}</b>`;
      document.getElementById('antwoord').value = '';
      document.getElementById('antwoord').style.display = '';
      document.getElementById('checkBtn').style.display = '';
      document.getElementById('feedback').textContent = '';
      setTimeout(() => { document.getElementById('antwoord').focus(); }, 100);
    }

    function controleerAntwoord() {
      const antwoord = parseInt(document.getElementById('antwoord').value, 10);
      if (antwoord === juisteAantal) {
        document.getElementById('feedback').textContent = 'Goed gedaan!';
        vuurwerk();
      } else {
        document.getElementById('feedback').textContent = `Helaas, het juiste antwoord was ${juisteAantal}. Probeer opnieuw!`;
      }
    }

    // Vuurwerk-animatie (canvas)
    function vuurwerk() {
      const canvas = document.getElementById('fireworkCanvas');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      canvas.style.display = 'block';
      let fireworks = [];
      for (let i = 0; i < 5; i++) {
        const x = randomInt(canvas.width * 0.2, canvas.width * 0.8);
        const y = randomInt(canvas.height * 0.2, canvas.height * 0.5);
        const color = kleuren[randomInt(0, kleuren.length - 1)].kleur;
        let particles = [];
        for (let j = 0; j < 30; j++) {
          const angle = (Math.PI * 2) * (j / 30);
          const speed = Math.random() * 4 + 2;
          particles.push({
            x: x, y: y,
            dx: Math.cos(angle) * speed,
            dy: Math.sin(angle) * speed,
            color: color,
            alpha: 1
          });
        }
        fireworks.push(particles);
      }
      let frame = 0;
      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        let done = true;
        for (let f of fireworks) {
          for (let p of f) {
            if (p.alpha > 0.05) {
              done = false;
              ctx.globalAlpha = p.alpha;
              ctx.beginPath();
              ctx.arc(p.x, p.y, 4, 0, 2 * Math.PI);
              ctx.fillStyle = p.color;
              ctx.fill();
              p.x += p.dx;
              p.y += p.dy;
              p.dy += 0.05; // gravity
              p.alpha *= 0.96;
            }
          }
        }
        ctx.globalAlpha = 1;
        frame++;
        if (!done && frame < 80) {
          requestAnimationFrame(animate);
        } else {
          canvas.style.display = 'none';
        }
      }
      animate();
    }

    document.getElementById('rollBtn').onclick = gooiDobbelstenen;
    document.getElementById('checkBtn').onclick = controleerAntwoord;
  </script>
</body>

</html>